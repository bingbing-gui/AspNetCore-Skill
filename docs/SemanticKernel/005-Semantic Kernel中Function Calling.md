ChatCompletion最强大功能之一就是能够从模型中调用函数。这让你可以基于现有代码创建聊天机器人，实现自动化业务流程、生成代码片段等功能。

在 Semantic Kernel 中，函数调用的过程被大幅简化：它会自动将你的函数和参数描述给模型，并处理模型与代码之间的沟通。了解这一机制对优化代码、充分发挥函数调用的优势至关重要。

## 自动函数调用的工作原理

在 Semantic Kernel 中，自动函数调用是默认行为，也可选择手动调用。启用函数调用时，模型会依照以下步骤进行处理：

1. **序列化函数**  
    kernel 中所有可用的函数及其输入参数都使用 JSON schema 进行序列化。

2. **将消息和函数发送给模型**  
    序列化后的函数（以及聊天历史）作为模型输入的一部分发送给模型。

3. **模型处理输入**  
    模型生成响应，可包含普通聊天消息或一个或多个函数调用。

4. **处理响应**  
    如果是聊天消息，直接返回给调用方；如果是函数调用，则提取函数名称和参数。

5. **调用函数**  
    使用提取到的函数名称和参数，在 kernel 中调用对应的函数。

6. **返回函数结果**  
    函数结果被添加至聊天历史并再次发送给模型。该循环会持续，直到模型返回聊天消息或达到设置的最大迭代次数。

