# 第14章-监督学习之多类分类 (Multiclass Classification)

## 什么是多类分类？

**多类分类 (Multiclass Classification)** 是 **监督学习 (Supervised Learning)** 的一种，用于 **预测观察结果属于多个可能类别中的哪一个**。

与回归和二元分类类似，它遵循相同的 **训练、验证和评估** 迭代过程，保留一部分数据用于 **验证模型**。

**示例**
- 预测 **邮件类别**（垃圾邮件 / 工作邮件 / 促销邮件）
- 预测 **疾病类型**（流感 / 感冒 / 过敏）
- 预测 **企鹅物种**（Adelie / 白眉企鹅 / 帽带企鹅）

---

## 示例：企鹅物种分类 

我们观察 **企鹅的鳍状肢长度 (x)**，并用它来预测 **企鹅的物种 (y)**。

**物种编号**
- **0**: **Adelie**
- **1**: **白眉企鹅**
- **2**: **帽带企鹅**

**示例数据**
| **鳍状肢长度 (x)** | **物种 (y)** |
|------------------|------------|
| 167            | 0          |
| 172            | 0          |
| 225            | 2          |
| 197            | 1          |
| 189            | 1          |
| 232            | 2          |
| 158            | 0          |

**目标**：训练一个模型，**输入鳍状肢长度 (x)**，预测 **企鹅物种 (y)**。

---

## 训练多类分类模型  

**多类分类算法的类型**
- **一对其他 (One-vs-Rest, OvR)** - 训练多个 **二元分类模型**，每个模型分别预测 **某一类别 vs. 其他类别**。
- **多项式分类 (Multinomial Classification)** - 训练一个 **多类别分类模型**，计算所有类别的概率。

---

### **一对其他 (OvR) 算法**
**思路**
- **为每个类别训练一个二元分类器**，计算属于该类别的概率：
  - **f0(x) = P(y=0 | x)**
  - **f1(x) = P(y=1 | x)**
  - **f2(x) = P(y=2 | x)**

**特点**
- **计算效率高**，适用于类别较少的情况。
- **训练多个二元分类模型**，每次分类计算代价较高。

---

### **多项式分类 (Multinomial Classification)**
**思路**
- **计算每个类别的概率**，然后选择 **概率最高的类别** 作为预测值。

**Softmax 函数**
$$
f(x) = [P(y=0|x), P(y=1|x), P(y=2|x)]
$$

**示例**
- **Softmax 计算输出**：
- **类 0 (Adelie)**: **20%**
- **类 1 (白眉企鹅)**: **30%**
- **类 2 (帽带企鹅)**: **50%** (最高)

**特点**
- **计算效率高**，适用于 **类别较多** 的情况。
- **一次训练出一个多类别模型**，减少训练成本。

---

## 评估多类分类模型  

**测试数据**
| **鳍状肢长度 (x)** | **实际物种 (y)** | **预测物种 (ŷ)** |
|------------------|------------|------------|
| 165            | 0          | 0          |
| 171            | 0          | 0          |
| 205            | 2          | 1          |
| 195            | 1          | 1          |
| 183            | 1          | 1          |
| 221            | 2          | 2          |
| 214            | 2          | 2          |

**多类分类的混淆矩阵**
| 预测 \ 实际 | **0** | **1** | **2** |
|-------------|------|------|------|
| **0**       | 2    | 0    | 0    |
| **1**       | 0    | 2    | 1    |
| **2**       | 0    | 1    | 2    |

**解释**
- **类 0**：
- 预测正确 **2 次 (TP)**
- 没有错误预测
- **类 1**：
- 预测正确 **2 次 (TP)**
- 误判 **1 次 (FP)**
- **类 2**：
- 预测正确 **2 次 (TP)**
- 误判 **1 次 (FN)**

---

## 计算评估指标  

**各类别的指标**

| 类别  | TP  | TN  | FP  | FN  | 准确率 (Accuracy) | 召回率 (Recall) | 精准率 (Precision) | F1 分数 (F1 Score) |
|------|----|----|----|----|-----------------|----------------|----------------|----------------|
| **0** | 2  | 5  | 0  | 0  | 1.00            | 1.00           | 1.00           | 1.00           |
| **1** | 2  | 4  | 1  | 0  | 0.86            | 1.00           | 0.67           | 0.80           |
| **2** | 2  | 4  | 0  | 1  | 0.86            | 0.67           | 1.00           | 0.80           |


**整体评估指标**
- **整体准确率 (Accuracy)**：
$$
Accuracy = \frac{(TP + TN)}{(TP + TN + FP + FN)}
$$
计算：
$$
Accuracy = \frac{13 + 6}{13 + 6 + 1 + 1} = 0.90
$$  
**90% 预测正确**。

- **整体召回率 (Recall)**
$$
Recall = \frac{TP}{TP + FN}
$$
计算：
$$
Recall = \frac{6}{6+1} = 0.86
$$  
**86% 的实际类别被正确识别**。

- **整体精准率 (Precision)**
$$
Precision = \frac{TP}{TP + FP}
$$
计算：
$$
Precision = \frac{6}{6+1} = 0.86
$$  
**预测为该类别的样本中，86% 是正确的**。

- **整体 F1 分数**
$$
F1 = \frac{2 \times Precision \times Recall}{Precision + Recall}
$$
计算：
$$
F1 = \frac{2 \times 0.86 \times 0.86}{0.86 + 0.86} = 0.86
$$  
**F1 分数 = 0.86，模型表现较好**。

---

## 总结

**多类分类适用于多个类别的预测问题**。  
**常见算法包括 OvR 和 Softmax (多项式回归)**。  
**评估多类分类时，可以分别计算每个类别的指标或整体指标**。  

**进一步学习**
- [Scikit-learn 多类分类](https://scikit-learn.org/stable/modules/multiclass.html)  
- [TensorFlow 分类教程](https://www.tensorflow.org/tutorials/keras/classification)  

📢 **欢迎 Star ⭐ 本仓库，获取更多 AI 资源！**
